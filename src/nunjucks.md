---
title: "Гайд по Nunjucks"
description: "Nunjucks — шаблонизатор для JavaScript, HTML-препроцессор"
permalink: /nunjucks.html
---

{% extends "layout.njk" %}

{% block content %}

<header>

# {{ title }}

<nav>
  <h2 class="heading">Навигация по странице</h2>
  <ol>
    <li><a href="#header-1">Введение.</a></li>
    <li><a href="#header-2">Переменные.</a></li>
    <li><a href="#header-3">Теги.</a></li>
    <li><a href="#header-4">Условия.</a></li>
    <li><a href="#header-5">Циклы.</a></li>
    <li><a href="#header-6">Наследование шаблонов.</a></li>
    <li><a href="#header-7">Фильтры.</a></li>
  </ol>
</nav>
</header>

<span class="cursive"><small class="bold">Дата последней правки: </small><time datetime="2025-07-03"><small>3 июля 2025</small></time></span>

<span class="cursive"><small class="bold">Примечание:</small> <small>если WebStorm не обнаруживает файлы Nunjucks, установите плагин TWIG.</small></span>

<section>

## <span id="header-1">Введение</span>

Nunjucks — это движок шаблонов для JavaScript и Node.js, который позволяет создавать динамические веб-страницы путём разделения логики и представления. Он работает как препроцессор, преобразующий шаблоны и данные в готовый HTML-код.

Nunjucks позволяет вставлять содержимое одного файла в другой. Это даёт возможность выносить в отдельные файлы разметку повторяющихся блоков.

✒️ <dfn>Препроцессор</dfn> — это специальный инструмент, который преобразует и расширяет исходный код из одного формата в другой перед выполнением или компиляцией.

</section>

---

<section>

## <span id="header-2">Переменные</span>

✒️ <dfn>Переменные</dfn> в Nunjucks — это именованные контейнеры для хранения значений, которые можно использовать в шаблоне. Nunjucks ищет значение переменной в контексте шаблона, который обычно содержит данные, переданные из приложения.
Часто возникает ситуация, когда одни и те же данные выводятся в разных местах сайта, например, контактные данные или заголовок страницы. Для этого используются переменные, которые позволяют задавать значения в начале кода и выводить их в нужных участках.

Переменные создаются и присваиваются с использованием тега `{% raw %} {% set %} {% endraw %}`.
Для вывода содержимого переменной используются двойные фигурные скобки `{% raw %} {{ имяПеременной }} {% endraw %}`:

```nunjucks {% raw %}
{% set pageTitle = 'Главная страница' %}
{{ pageTitle }}
{% endraw %}
```

Вывод кода будет: «<samp>Главная страница</samp>».

Переменные доступны только после их объявления. По умолчанию они работают внутри текущего шаблона. Имена переменных могут содержать точку (`.`), которая используется для доступа к свойствам объекта: 

```liquid {% raw %}
{{ post.url }}
{% endraw %}
```

Также можно использовать синтаксис квадратных скобок: 

```liquid {% raw %} 
{{ post ['url'] }} 
{% endraw %}
```

Если значение равно `undefined` или `null`, то ничего не отобразится.

Можно задавать несколько переменных одновременно:

```nunjucks {% raw %}
{% set x = 1, y = 2, z = 3 %}
{% endraw %}
```

Если `set` используется вне блоков с областью видимости (таких как блоки, определяемые `include`, `block` или `macro`), он изменяет значение в контексте текущего шаблона и шаблонов, которые он включает. Если `set` используется внутри блоков с областью видимости, таких как `include`, то он изменяет только текущую область видимости.

Типы данных в Nunjucks:
+ Строки: `{% raw %} {% set name = 'Волга' %} {% endraw %}`;
+ Числа: `{% raw %} {% set age = 5 %} {% endraw %}`;
+ Булевы значения: `{% raw %} {% set isAdmin = true %} {% endraw %}`;
+ Массивы: `{% raw %} {% set cars = ['Волга', 'Лада'] %} {% endraw %}`;
+ Объекты: `{% raw %} {% set user = { name: 'Иван', age: 30 } %} {% endraw %}`.

</section>

---

<section>

## <span id="header-3">Теги</span>

✒️ <dfn>Теги</dfn> в Nunjucks — это специальные конструкции, используемые для контроля потока выполнения шаблона, реализации логики и организации структуры документа. Они являются основным строительным блоком для создания динамических шаблонов.
Nunjucks использует синтаксис `{% raw %} {%...%} {% endraw %}` для управляющих операторов, таких как циклы, условные операторы и объявления переменных. Например:

```liquid {% raw %}
<ul>
    {% for brand in brands %}
        <li>{{ brand }}</li>
    {% endfor %}
</ul>
{% endraw %}
```

Nunjucks также предоставляет механизм для наследования шаблонов. Блоки, определяемые с помощью тега `{% raw %} {% block %} {% endraw %}`, представляют собой именованные участки в шаблонах, которые можно переопределить в дочерних шаблонах, реализуя таким образом механизм наследования и повторного использования кода. Как правило, есть открывающая часть `{% raw %} {% block blockName %} {% endraw %}` и закрывающая `{% raw %} {% endblock %} {% endraw %}`.

Чтобы вывести какой-либо из специальных тегов Nunjucks, можно заключить их внутри тега `{% raw %} {% raw %}...{% endraw %} {% endraw %}`. Всё, что находится внутри него, будет выведено как обычный текст. Это полезно при документировании или создании учебных материалов по Nunjucks:

```nunjucks {% raw %}
{% raw %}
{% if true %}
    {{ 'Добро пожаловать' }}
{% endif %}
{% endraw %}
{% endraw %}
```

Результатом будет:

```liquid {% raw %}
{% if true %}
    {{ 'Добро пожаловать' }}
{% endif %}
{% endraw %}
```

Когда Nunjucks обрабатывает шаблоны, он не удаляет переносы строк и пробелы вокруг тегов. Символ минус (`-`) добавляется внутри тега, сразу после открывающей скобки `{% raw %} {%- {% endraw %}` для удаления пробелов слева или перед закрывающей скобкой `{% raw %} -%} {% endraw %}` для удаления пробелов справа:

```liquid {% raw %}
{% for i in [1, 2, 3, 4, 5] -%}
{{ i }}
{%- endfor%}
{% endraw %}
```

Вывод этого кода будет: «<samp>12345</samp>».

То же самое касается переменных: `{% raw %} {{- {% endraw %}` удалит пробелы перед переменной, а `{% raw %} -}} {% endraw %}` удалит пробелы после переменной. Удаление пробелов работает и для других тегов (условия, макросы и т.д.).

Комментарии используются для добавления примечаний или пояснений к коду, которые игнорируются шаблонизаторами и не отображаются на странице: `{% raw %} {# комментарий #} {% endraw %}`.

</section>

---

<section>

## <span id="header-4">Условия</span>

✒️ <dfn>Условия</dfn> в Nunjucks — это механизм управления потоком выполнения шаблона, позволяющий отображать разный контент в зависимости от определённых условий. Это позволяет создавать динамические шаблоны, которые адаптируются под различные данные и ситуации, например, отображать разный контент для авторизованных и неавторизованных пользователей.

Условные операторы, такие как `if`, `elif` и `else`, позволяют выполнять различные действия в зависимости от определённых условий.

Условный оператор `if` проверяет условие и выборочно отображает содержимое:

```liquid {% raw %}
{% if variable %}
    Это верно
{% endif %}
{% endraw %}
```

Если переменная определена и оценивается как true (в Nunjucks это, например, непустая строка, число не равное 0, или логическое true), то будет отображено «<samp>Это верно</samp>». Иначе ничего не будет отображено.

Также есть возможность указать альтернативные условия с помощью конструкций `elif` и `else`:

```liquid {% raw %}
{% if page == 'home' %}
    Контент для главной страницы
{% elif page == 'contact' %}
    Контент для страницы контактов
{% else %}
    Контент для остальных страниц
{% endif %}
{% endraw %}
```

Предполагается, что `page` — это переменная, доступная в Nunjucks шаблоне, которая содержит строку с названием страницы (например, `home`, `contact`).

Если значение переменной `page` равно `home`, то будет показан контент для главной страницы. Если значение равно `contact`, будет показан контент для страницы контактов. Во всех остальных случаях будет показан общий контент.

+ `{% raw %} {% if page == 'home' %} {% endraw %}` проверяет первое условие.
+ `{% raw %} {% elif page == 'contact' %} {% endraw %}` проверяет второе условие, если первое не выполнилось.
+ `{% raw %} {% else %} {% endraw %}` выполняется, если ни одно из предыдущих условий не оказалось истинным.
+ `{% raw %} {% endif %} {% endraw %}` завершает условное выражение.

Оператор `==` (равно) сравнивает два значения на равенство.

Оператор `!=` (не равно) сравнивает два значения на неравенство.

Операторы сравнения: `>` (больше), `<` (меньше), `>=` (больше или равно), `<=` (меньше или равно).

Можно указать несколько условий с помощью `and` и `or`:

```liquid {% raw %}
{% if happy and hungry %}
    Я счастлив и голоден; оба условия верны
{% endif %}
{% if happy or hungry %}
    Я счастлив или голоден; верно хотя бы одно из условий
{% endif %}
{% endraw %}
```

Оператор `and`: оба условия должны быть истинными, чтобы результат был истинным. Например: `{% raw %} {% if 1 == 1 and 2 == 2 %} {% endraw %}` (истинно, так как оба условия истинны).

Оператор `or`: хотя бы одно из условий должно быть истинным, чтобы результат был истинным. Например: `{% raw %} {% if 1 == 1 or 2 == 3 %} {% endraw %}` (истинно, так как первое условие истинно).

Операторы `and` и `or` работают в соответствии с законами логики. Порядок вычисления условий определяется приоритетом операторов (`and` имеет более высокий приоритет, чем `or`), но его можно изменить с помощью скобок.

</section>

---

<section>

## <span id="header-5">Циклы</span>

✒️ <dfn>Циклы</dfn> в Nunjucks — это механизм для повторяющегося выполнения блока кода над коллекцией данных (массивами, объектами или другими перебираемыми структурами). Они позволяют автоматически генерировать повторяющиеся части шаблона.

В Nunjucks для организации циклов используется конструкция `for...in` (или просто `for`), которая, как и в JavaScript, предназначена для перебора элементов массива или свойств объекта. При работе с массивами цикл перебирает элементы, которые затем можно использовать для доступа к их свойствам:

```liquid {% raw %}
{% set brands = [
{ brand: 'Lada', country: 'USSR' },
{ brand: 'BMW', country: 'Germany' }
] %}

{% for item in brands %}
<p>Модель: {{ item.brand }}; Страна: {{ item.country }}</p>
{% endfor %}
{% endraw %}
```

Вывод кода будет:

```html
<p>Модель: Lada; Страна: USSR</p>
<p>Модель: BMW; Страна: Germany</p>
```

В этом примере перечислены все элементы, используя атрибуты `brand` и `country` каждого элемента в массиве `brands`. Оператор `for` проходит по списку и выполняет действие для каждого элемента.

Также можно итерироваться по диапазону чисел:

```liquid {% raw %}
{% for i in range(0, 5) %}
    <p>Номер: {{ i }}</p>
{% endfor %}
{% endraw %}
```

Для данного примера Nunjucks выведет следующий HTML:

```html
<p>Номер: 0</p>
<p>Номер: 1</p>
<p>Номер: 2</p>
<p>Номер: 3</p>
<p>Номер: 4</p>
```

Внутри цикла доступны специальные переменные:
+ `loop.index`: Текущий индекс цикла (начинается с 1).
+ `loop.first: true`, если это первая итерация цикла.
+ `loop.last: true`, если это последняя итерация цикла.

</section>

---

<section>

## <span id="header-6">Наследование шаблонов</span>

Наследование шаблонов помогает создавать согласованную структуру веб-сайта, позволяя повторно использовать базовый шаблон и настраивать определённые части для разных страниц. Например, заголовок и футер страницы обычно имеют одинаковое содержимое на всех страницах. Поэтому нет смысла дублировать их везде, вместо этого можно определить их в одном файле и использовать его на всех страницах.

`extends` используется для указания наследования шаблона. Указанный шаблон используется как базовый: 

```nunjucks {% raw %}
{% extends 'base.html' %}
{% endraw %}
```

С помощью `include` можно вставлять повторно используемые компоненты или частичные шаблоны в основные шаблоны:

```nunjucks {% raw %}
{% include 'header.html' %}
{% endraw %}
```

Эта функция помогает поддерживать согласованную структуру на сайте и избегать повторения кода. Важно отметить, что `include` просто вставляет содержимое одного файла в другой, без какой-либо логики наследования или переопределения блоков.

Использование `include` и наследование шаблонов соответствуют принципу DRY (Don't Repeat Yourself — не повторяйся).  Идея состоит в том, что если нужно написать код более одного раза в нескольких местах, то его следует поместить в функцию.

`block` определяет раздел в шаблоне и идентифицирует его с помощью имени. Это используется при наследовании шаблонов. Базовые шаблоны могут указывать блоки, а дочерние шаблоны могут переопределять их новым содержимым:

<figure>

```liquid {% raw %}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}Мой сайт{% endblock %}</title>
    {% block css %}
        <link rel="stylesheet" href="main.css"/>
    {% endblock %}
</head>
<body>
    {% block content %}{% endblock %}
</body>
</html>
{% endraw %}
```

<figcaption>Файл <span class="blue">base.html</span></figcaption>
</figure>

<figure>

```liquid {% raw %}
{% extends 'base.html' %}

{% block title %}Главная страница{% endblock %}

{% block content %}
    <h1>Добро пожаловать!</h1>
    <p>Это главная страница сайта.</p>
{% endblock %}
{% endraw %}
```

<figcaption>Файл <span class="blue">index.html</span> (дочерний шаблон)</figcaption>
</figure>

В этом примере <span class="blue">index.html</span> наследует от <span class="blue">base.html</span> и переопределяет блоки `title` и `content`. Блок `css` наследуется из <span class="blue">base.html</span>.

</section>

---

<section>

## <span id="header-7">Фильтры</span>

✒️ <dfn>Фильтры</dfn> в Nunjucks — это функции, которые применяются к переменным для преобразования или форматирования их значений перед отображением. Фильтры указываются после символа вертикальной черты (`|`) и позволяют модифицировать данные перед выводом в шаблоне.

Например, с помощью фильтра `upper` можно перевести текст в верхний регистр перед его выводом на страницу:

```liquid {% raw %}
<h1>{{ 'Conspect' | upper }}</h1>  <!-- код в шаблоне Nunjucks -->
<h1>CONSPECT</h1>  <!-- результирующий HTML -->
{% endraw %}
```

Фильтры можно встраивать в цепочки для последовательной обработки данных: 

```liquid {% raw %}
{{ "mOdEl" | replace ('mOdEl', 'BrAnD') | capitalize }}
{% endraw %}
```

Этот код выведет «<samp>Brand</samp>», сначала заменив `mOdEl` на `BrAnD`, а затем сделав первую букву заглавной.

Если в среде включено автоматическое экранирование, то весь вывод будет автоматически экранироваться для безопасного отображения. Чтобы вручную пометить вывод как безопасный, можно использовать фильтр `safe`. Nunjucks не будет экранировать этот вывод:

```liquid {% raw %}
{{ brand }}  <!-- Вывод: &amp;lt;span&amp;gt; -->
{{ brand | safe }}  <!-- Вывод: <span> -->
{% endraw %}
```

Если автоэкранирование отключено, то весь вывод будет отображаться как есть.

Фильтр `safe` следует использовать с осторожностью, поскольку он отключает экранирование и может привести к XSS-уязвимостям, если значение переменной получено из ненадёжного источника (например, от пользователя).

Можно вручную экранировать переменные с помощью фильтра `escape`. Фильтр преобразует символы `&`, `<`, `>` и `"` в HTML-безопасные последовательности. Это полезно, если нужно отобразить текст, который может содержать HTML-символы, а также для предотвращения HTML-инъекций. Возвращаемое значение интерпретируется как строка разметки:

```liquid {% raw %}
{{ brand }}  <!-- Вывод: <span> -->
{{ brand | escape }}  <!-- Вывод: &amp;lt;span&amp;gt; -->
{% endraw %}
```

✒️ <dfn>HTML-инъекция</dfn> — это тип уязвимости веб-приложений, который позволяет злоумышленнику внедрить произвольный HTML-код в веб-страницу, отображаемую другим пользователям. Это происходит, когда веб-приложение принимает данные от пользователя (например, через форму, URL-параметр или cookie) и включает эти данные в HTML-код страницы без должной проверки и экранирования.

Фильтр `abs` возвращает абсолютное значение аргумента: 

```liquid {% raw %}
{{ -3 | abs }}
{% endraw %}
```

Вывод кода будет: «<samp>3</samp>».

Фильтр `capitalize` делает первую букву заглавной, а остальные строчными: 

```liquid {% raw %}
{{ CoLLEctions | capitalize }}
{% endraw %}
```

Вывод кода будет: «<samp>Collections</samp>».

Фильтр `lower` преобразует строку в нижний регистр:

```liquid {% raw %}
{{ COLLECTIONS | lower }}
{% endraw %}
```

Вывод кода будет: «<samp>collections</samp>».

Фильтр `random` выбирает случайное значение из массива (оно будет меняться при каждом обновлении страницы): 

```liquid {% raw %}
{{ [1,2,3,4,5,6] | random }}
{% endraw %}
```

Вывод кода будет: случайное значение от 1 до 6 включительно.

Фильтр `reverse` переворачивает строку или массив:

```liquid {% raw %}
{{ abcdef | reverse }}
{% endraw %}
```

Вывод кода будет: «<samp>fedcba</samp>». А чтобы перевернуть массив:

```liquid {% raw %}
{% for i in [1, 2, 3, 4] | reverse %}
    {{ i }}
{% endfor %}
{% endraw %}
```

В этом примере цикл `for` будет итерироваться в обратном порядке: «<samp>4, 3, 2, 1</samp>».

Фильтр `title` делает первую букву каждого слова заглавной:

```liquid {% raw %}
{{ collections car germany | title }}
{% endraw %}
```


Вывод кода будет: «<samp>Collections Car Germany</samp>».

Фильтр `upper` преобразует строку в верхний регистр:

```liquid {% raw %}
{{ ussr | upper }}
{% endraw %}
```

Вывод кода будет: «<samp>USSR</samp>».

{% include 'top.njk' %}

<footer>
<section aria-labelledby="sources-title">
<h2 id="sources-title" class="message">Источники:</h2>
<ul class="source-list">

{% set sources = [
{
href: 'https://mozilla.github.io/nunjucks/templating.html',
img: 'assets/img/nunjucks/nunjucks.svg',
width: '40',
height: '40',
alt: 'сайт Nunjucks',
cite: 'Nunjucks Docs'
}
] %}

{% for source in sources %}
{% include 'footer-sources.njk' %}
{% endfor %}

</ul>
</section>
</footer>

{% endblock %}